<hr>
<p>title: SSM-Mybatis【入门一】<br>date: 2020-05-26 21:00:00                  #文章生成時間<br>categories: “SSM”               #文章分類目錄 可以省略<br>tags:<br>     - Mybatis</p>
<hr>
<h4 id="一、Mybatis是什么"><a href="#一、Mybatis是什么" class="headerlink" title="一、Mybatis是什么"></a>一、Mybatis是什么</h4><p>在学习Mybatis之前，先了解一下，什么是框架？<!-- more --><br>通俗一点来说，框架其实就是某种应用的半成品，就是一组组件，供你选用完成你自己的系统。就是使用别<br>人搭好的舞台，你来做表演。而且，框架一般是成熟的，不断升级的软件。<br>而我们的Mybatis就是一个基于Java的持久层框架。</p>
<h4 id="二、为什么要使用Mybatis"><a href="#二、为什么要使用Mybatis" class="headerlink" title="二、为什么要使用Mybatis"></a>二、为什么要使用Mybatis</h4><p>其实在这之前，我们肯定已经学习过很多的持久层技术解决方案，如：<br>JDBC技术、Spring的JdbcTemplate、Apache的DBUtils<br>但是JDBC技术开发起来太麻烦了，很多繁琐的细节都需要自己做；<br>Spring的JdbcTemplate、Apache的DBUtils都只是工具类，封装的不够完美。<br>因此封装的更完美的Mybatis框架就受到欢迎了。<br>简而言之，Mybatis框架封装了jdbc操作的很多细节，使<strong>开发者只需要关注sql语句本身</strong>，而无需关注注册驱动，创建连接等繁杂过程；而且它<strong>使用了ORM思想实现了结果集的封装</strong>。</p>
<h4 id="三、Mybatis的快速入门案例"><a href="#三、Mybatis的快速入门案例" class="headerlink" title="三、Mybatis的快速入门案例"></a>三、Mybatis的快速入门案例</h4><h5 id="（一）需求"><a href="#（一）需求" class="headerlink" title="（一）需求"></a>（一）需求</h5><p>下面就通过一个简单的案例来快速上手Mybatis。<br><strong>需求</strong>：名为mybatis数据库中有一张user表，现使用Mybatis框架实现查询该user表中所有用户信息。</p>
<h5 id="（二）数据库"><a href="#（二）数据库" class="headerlink" title="（二）数据库"></a>（二）数据库</h5><p>user表的结构如下：<br><img src="SSM-Mybatis%5B%E5%85%A5%E9%97%A8%E4%B8%80%5D/user_1.png" alt="user_1"><br>user表中数据如下：<br><img src="C:%5CUsers%5CASUS%5CDesktop%5Cuser_2.png" alt="user_2"></p>
<h5 id="（三）需求实现"><a href="#（三）需求实现" class="headerlink" title="（三）需求实现"></a>（三）需求实现</h5><p>步骤大致如下：<br>1、创建一个Maven项目，并引入相关依赖的坐标</p>
<pre><code class="xml"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>
    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></code></pre>
<p>2、编写与user表相对应的JavaBean类，创建Dao接口（也可以叫做Mapper）<br>JavaBean的创建非常简单，故省略；Dao接口如下：</p>
<pre><code class="java"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>{
    <span class="comment">/**</span>
<span class="comment">     * 查询所有用户</span>
<span class="comment">     * <span class="doctag">@return</span></span>
<span class="comment">     */</span>
    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;
}
</code></pre>
<p>注意：该案例中没有将JavaBean对象和user表做映射操作，所以要求JavaBean类中的属性名必须和user表中的列名相对应。<br>3、编写Dao的配置文件(IUserDao.xml)</p>
<pre><code class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span>
<span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span>
<span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>

<span class="comment">&lt;!--该文件为映射配置文件，每个dao都有自己独立的配置文件--&gt;</span>
<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zuobiao.dao.IUserDao"</span>&gt;</span>  <span class="comment">&lt;!-- 必须是dao接口的全限定类名 --&gt;</span>

    <span class="comment">&lt;!--每一个标签对应一个dao接口中的方法--&gt;</span>
    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.zuobiao.domain.User"</span>&gt;</span>
        select * from user
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>
<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></code></pre>
<p>注：Mybatis的映射配置文件(即：IUserDao.xml)位置必须和dao接口的包结构相同，如：<br><img src="C:%5CUsers%5CASUS%5CDesktop%5C04.png" alt="03"><br>4、编写Mybatis的主配置文件(SqlMapConfig.xml)</p>
<pre><code class="xml"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span>
<span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span>
<span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span>

<span class="comment">&lt;!--mybatis的主配置文件--&gt;</span>
<span class="tag">&lt;<span class="name">configuration</span>&gt;</span>
    <span class="comment">&lt;!-- 配置环境--&gt;</span>
    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span>  <span class="comment">&lt;!-- 该名称可以随便取 --&gt;</span>
        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span>    <span class="comment">&lt;!-- 该名称必须和父标签中的default属性值保持一致 --&gt;</span>
           <span class="comment">&lt;!-- 配置事务类型 --&gt;</span>
            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span>
           <span class="comment">&lt;!--配置数据源（连接池）--&gt;</span>
            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span>
               <span class="comment">&lt;!-- 配置连接数据库的4个基本信息 --&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC"</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span>
                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span>

<span class="comment">&lt;!--    指定映射配置文件的位置    --&gt;</span>
<span class="comment">&lt;!--    映射配置文件指的是每个Dao独立的配置文件--&gt;</span>
    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span>
        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/zuobiao/dao/IUserDao.xml"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>
<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></code></pre>
<p>5、进行测试</p>
<pre><code class="java"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>{
    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>{
        <span class="comment">/**</span>
<span class="comment">         * 1、读取配置文件</span>
<span class="comment">         * 2、创建SqlSessionFactory工厂对象</span>
<span class="comment">         * 3、使用工厂生产SqlSession对象</span>
<span class="comment">         * 4、使用SqlSession对象创建dao接口的代理对象</span>
<span class="comment">         * 5、使用代理对象执行方法</span>
<span class="comment">         * 6、释放资源</span>
<span class="comment">         */</span>
        <span class="comment">//1、读取配置文件</span>
        InputStream is = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);

        <span class="comment">//2、创建SqlSessionFactory工厂对象</span>
        SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();
        SqlSessionFactory factory = builder.build(is);

        <span class="comment">//3、使用工厂生产SqlSession对象</span>
        SqlSession session = factory.openSession();

        <span class="comment">//4、使用SqlSession对象创建dao接口的代理对象</span>
        IUserDao userdao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;

        <span class="comment">//5、使用代理对象执行方法</span>
        List&lt;User&gt; users = userdao.findAll();
        <span class="keyword">for</span> (User user : users) {
            System.out.println(user);
        }

        <span class="comment">//6、释放资源</span>
        session.close();
        is.close();
    }
}</code></pre>
<p>测试结果如下：<br><img src="C:%5CUsers%5CASUS%5CDesktop%5C04.png" alt="04"><br>目前需求就已经实现啦！</p>
<h5 id="（四）注意"><a href="#（四）注意" class="headerlink" title="（四）注意"></a>（四）注意</h5><p>观察仔细的小伙伴可能已经发现了，我们并没有实现IUserDao接口。<br>确实是的，我们在实际开发中一般不会使用实现接口的方式，在实际开发中更多的是考虑开发的时间成本，没有必要通过实现接口的方式来完成需求。但是，这并不代表Mybatis不支持实现Dao接口（<a href="" target="_blank">实现接口的案例在此处</a>）。<br>我们使用的是不实现Dao接口的方式，因此需要遵守下列3个规范：<br><strong>a. mybatis的映射配置文件位置必须和dao接口的包结构相同（前面已经提到过）</strong><br><strong>b. 映射配置文件的mapper标签namespace属性的取值必须是dao接口的全限定类名</strong><br><strong>c. 映射配置文件的操作配置（select），id属性的取值必须是dao接口的方法名</strong></p>
<h4 id="四、详细分析"><a href="#四、详细分析" class="headerlink" title="四、详细分析"></a>四、详细分析</h4><p>下面针对测试测试类中的核心代码进行分析：</p>
<pre><code class="java"><span class="comment">/*Mybatis提供的用来加载配置稳健的类*/</span>
Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</code></pre>
<pre><code class="java"><span class="comment">/*使用了构建者模式：把对象的创建细节隐藏，让使用者直接调用方法即可创建对象*/</span>
SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();
SqlSessionFactory factory = builder.build(is);</code></pre>
<pre><code class="java"><span class="comment">/*使用了工厂设计模式：有利于降低类之间的依赖关系，从而达到解耦的目的*/</span>
SqlSession session = factory.openSession();</code></pre>
<pre><code class="java"><span class="comment">/*使用了代理设计模式：在不修改源码的基础上对已有方法进行增强，此处其实就是我们可以不用实现Dao接口就可以执行方法，从而达到增强的效果*/</span>
IUserDao userdao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;
List&lt;User&gt; users = userdao.findAll();</code></pre>
<h4 id="五、设计模式补充"><a href="#五、设计模式补充" class="headerlink" title="五、设计模式补充"></a>五、设计模式补充</h4><p>想要了解更多关于设计模式的知识，可以参考以下文章：<br>1、<a href="" target="_blank">构建者模式</a><br>2、<a href="" target="_blank">工厂模式</a><br>3、<a href="https://zuobiao-x.github.io/2020/05/01/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F--%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E3%80%90%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E3%80%91/" target="_blank">代理模式</a></p>
<p><strong>Java新手，若有错误，欢迎指正！</strong></p>
